classDiagram
    class User {
        +String id PK
        +String email
        +String role "Values: admin, contributor, voter"
        +Int creationReputation
        +Int contributorReputation
    }

    class RootEnvironment {
        +String id PK
        +String name
        +Array~String~ sets "e.g., ['V', 'F']"
        +Array~String~ operators "e.g., ['+', 'Â·']"
        +Array~String~ rootAxiomIds "Pointers to the Axiom Registry"
    }

    class Axiom {
        +String id PK
        +String canonicalName "e.g., 'Commutativity'"
        +Array~String~ aliases "Tags/Synonyms: ['Abelian', 'Symmetric']"
        +String defaultLatex "e.g., a \cdot b = b \cdot a"
        +String authorId FK
        +Timestamp createdAt
    }
    
    note for Axiom "The 'Concept' Library.\nStores unique definitions."

    class Node {
        +String id PK
        +String parentId FK
        +String authorId FK
        
        +String axiomId FK "LOGIC: Links to the Concept"
        +String displayLatex "VISUAL: The Notation Override"
        
        +String status "Values: unverified, verified, contested, deadEnd, deprecated"
        
        +String duplicateOfId "Pointer to the Survivor Node"
        +Boolean toBeDeleted "Deprecation Flag (Triggers Yellow Flash)"
        
        +Int voteCountGreen
        +Int voteCountBlack
        +Int flagCountYellow
    }

    class Vote {
        +String id PK
        +String targetId FK "Polymorphic: Points to Node OR Theorem" 
        +String targetType "Values: node, theorem"
        +String userId FK
        +String type "Values: green, black"
        +Timestamp timestamp
    }
    
    class Flag {
        +String id PK
        +String type "Values: issue, duplicate"
        
        +String targetId FK "Polymorphic: Points to Node OR Theorem"
        +String targetType "Values: node, theorem"
        
        +String reporterId FK
        +String reason 
        +String suggestedFixLatex 
        
        +String duplicateOfId "Points to Survivor"
        +String status
    }
    
    class Theorem {
        +String id PK
        +String nodeId FK "CONTEXT: The Structural Parent (Axiom Node)"
        +String parentId FK "LOGIC: The Deductive Parent (Previous Theorem)"
        
        +String statementLatex
        +String proofLatex
        +String authorId FK
        
        +String status "Values: unverified, verified, deprecated"
        +String duplicateOfId "Pointer to Survivor Theorem (Zombie Logic)"
        +Boolean toBeDeleted "Triggers Yellow Flash in Theorem Tree"
        
        +Int voteCountGreen
        +Int voteCountBlack
    }

    %% Relationships
    User "1" -- "*" Node : creates
    User "1" -- "*" Axiom : creates
    User "1" -- "*" Theorem : creates
    User "1" -- "*" Vote : casts
    User "1" -- "*" Flag : reports
    
    Axiom "1" -- "*" Node : defines
    
    %% The Fractal Structure
    Node "1" -- "*" Node : branches (Structural Tree)
    Theorem "1" -- "*" Theorem : derives (Deductive Tree)
    
    %% Contextual Linking
    Node "1" -- "*" Theorem : contains (The Local)